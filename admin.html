<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel | Dev Communication</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; padding: 30px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { background: #1e293b; padding: 20px; border-radius: 12px; border: 1px solid #334155; margin-bottom: 20px; }
        h2 { color: #38bdf8; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        
        .user-row { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px; background: #0f172a; border-radius: 8px; margin-top: 10px;
        }
        
        button { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-allow { background: #22c55e; color: white; }
        .btn-deny { background: #ef4444; color: white; margin-left: 5px; }
        .btn-kick { background: #f59e0b; color: white; }
        
        #login-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #0f172a; display: flex; justify-content: center; align-items: center; z-index: 100;
        }

        input { padding: 10px; border-radius: 6px; border: 1px solid #334155; background: #0f172a; color: white; outline: none; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="section" style="width: 300px; text-align: center;">
            <h3>Admin Login</h3>
            <input type="password" id="adminPass" placeholder="Password" style="width: 80%; margin-bottom: 15px;">
            <br>
            <button class="btn-allow" onclick="login()">Enter Dashboard</button>
        </div>
    </div>

    <div class="container">
        <h1>Admin Control Center</h1>

        <div class="section">
            <h2>Pending Requests</h2>
            <div id="pending-list">
                <p style="color: #94a3b8;">No pending requests...</p>
            </div>
        </div>

        <div class="section">
            <h2>Acti Users</h2>
            <div id="active-list">
                <p style="color: #94a3b8;">No users online...</p>
            </div>
        </div>
    </div>

<script>
    const socket = io();
    let password = "";

    function login() {
        const input = document.getElementById('adminPass').value;
        if (!input) return;
        password = input;
        document.getElementById('login-overlay').style.display = 'none';
        
        // Request the current state of the server immediately after login
        socket.emit("admin-fetch-lists", password);
    }

    // Enter key support for login
    document.getElementById('adminPass').addEventListener('keypress', (e) => {
        if(e.key === 'Enter') login();
    });

    // 1. When a new person requests access, ask server for the fresh list
    socket.on('admin-notification', () => {
        if(password) socket.emit("admin-fetch-lists", password);
    });

    // 2. Listen for full list updates and redraw the UI
    socket.on('user-list-update', (lists) => {
        renderLists(lists.pending, lists.active);
    });

    function renderLists(pending, active) {
        const pList = document.getElementById('pending-list');
        const aList = document.getElementById('active-list');

        // Clear and render Pending List
        pList.innerHTML = pending.length ? "" : '<p style="color: #94a3b8;">No pending requests...</p>';
        pending.forEach(name => {
            const div = document.createElement('div');
            div.className = "user-row";
            div.innerHTML = `
                <span>${name}</span> 
                <div>
                    <button class="btn-allow" onclick="exec('allow ${name}')">Allow</button>
                    <button class="btn-deny" onclick="exec('deny ${name}')">Deny</button>
                </div>`;
            pList.appendChild(div);
        });

        // Clear and render Active List
        aList.innerHTML = active.length ? "" : '<p style="color: #94a3b8;">No users online...</p>';
        active.forEach(name => {
            const div = document.createElement('div');
            div.className = "user-row";
            div.innerHTML = `
                <span>${name} (Online)</span> 
                <button class="btn-kick" onclick="exec('kick ${name}')">Kick</button>`;
            aList.appendChild(div);
        });
    }

    function exec(fullCommand) {
        socket.emit("admin-command", { password: password, fullCommand: fullCommand });
    }
</script>
</body>
</html>